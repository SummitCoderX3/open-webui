

<script lang="ts">
	import { getContext } from 'svelte';
	import { toast } from 'svelte-sonner';
	import {  deleteChatById } from '$lib/apis/chats';
	import { WEBUI_NAME, chatId, modelfiles, settings, showSettings } from '$lib/stores';

	import { slide } from 'svelte/transition';
	import ShareChatModal from '../chat/ShareChatModal.svelte';
	import ModelSelector from '../chat/ModelSelector.svelte';
	import Tooltip from '../common/Tooltip.svelte';
	import Menu from './Navbar/Menu.svelte';

	const i18n = getContext('i18n');
	

	export let initNewChat: Function;
	export let title: string = $WEBUI_NAME;
	export let shareEnabled: boolean = false;

	export let chat;
	export let selectedModels;

	export let showModelSelector = true;

	let showShareChatModal = false;
	let showDownloadChatModal = false;

	const toggleOnline = async () => {
		$settings.online = !$settings.online 
	};
</script>

<ShareChatModal bind:show={showShareChatModal} chatId={$chatId} />
<nav id="nav" class=" sticky py-2.5 top-0 flex flex-row justify-center z-30">
	<div
		class=" flex {$settings?.fullScreenMode ?? null ? 'max-w-full' : 'max-w-3xl'} 
		 w-full mx-auto px-3"
	>
		<div class="flex items-center w-full max-w-full">
			<div class="flex-1 overflow-hidden max-w-full">
				{#if showModelSelector}
					<ModelSelector bind:selectedModels />
				{/if}
			</div>

			<div class="self-start flex flex-none items-center">
				<div class="flex self-center w-[1px] h-5 mx-2 bg-gray-300 dark:bg-stone-700" />

				{#if !shareEnabled}
					<Tooltip content="Settings">
						<button
							class="cursor-pointer p-1.5 flex dark:hover:bg-gray-700 rounded-full transition"
							id="open-settings-button"
							on:click={async () => {
								await showSettings.set(!$showSettings);
							}}
						>
							<svg
								xmlns="http://www.w3.org/2000/svg"
								fill="none"
								viewBox="0 0 24 24"
								stroke-width="1.5"
								stroke="currentColor"
								class="w-5 h-5"
							>
								<path
									stroke-linecap="round"
									stroke-linejoin="round"
									d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z"
								/>
								<path
									stroke-linecap="round"
									stroke-linejoin="round"
									d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"
								/>
							</svg>
						</button>
					</Tooltip>
				{:else}
					<Menu
						{chat}
						{shareEnabled}
						shareHandler={() => {
							showShareChatModal = !showShareChatModal;
						}}
						downloadHandler={() => {
							showDownloadChatModal = !showDownloadChatModal;
						}}
					>
						<button
							class="cursor-pointer p-1.5 flex dark:hover:bg-gray-700 rounded-full transition"
						>
							<div class=" m-auto self-center">
								<svg
									xmlns="http://www.w3.org/2000/svg"
									fill="none"
									viewBox="0 0 24 24"
									stroke-width="1.5"
									stroke="currentColor"
									class="size-5"
								>
									<path
										stroke-linecap="round"
										stroke-linejoin="round"
										d="M6.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM12.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM18.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Z"
									/>
								</svg>
							</div>
						</button>
					</Menu>
				{/if}
				<Tooltip content="Go Online">
					<button
						id="online-button" 
						class=" cursor-pointer p-1.5 flex dark:hover:bg-gray-700 rounded-full transition"
						on:click={() => {
							toggleOnline();
						}}
					>
						<div class=" m-auto self-center">
							{#if $settings.online }
							<svg fill="#333" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 42.333 42.333" xml:space="preserve" stroke="#333">
								<g id="SVGRepo_bgCarrier" stroke-width="0"></g>
								<g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
								<g id="SVGRepo_iconCarrier">
								  <g>
									<g>
									  <path d="M16.637,33.992l0.057-0.959c-0.204-0.025-0.414-0.056-0.621-0.083C16.252,33.307,16.438,33.658,16.637,33.992z"></path>
									  <path d="M39.002,10.717c-0.274-0.39-0.562-0.77-0.869-1.136C34.807,5.589,29.8,3.043,24.208,3.043c-0.009,0-0.018,0-0.025,0 c-0.007,0-0.012,0-0.017,0c-0.021,0-0.042,0.002-0.062,0.002c-5.548,0.032-10.511,2.571-13.817,6.536 c-0.305,0.366-0.594,0.746-0.869,1.135c-2.095,2.956-3.332,6.56-3.332,10.45c0,0.521,0.026,1.039,0.07,1.55 c0.449,0.296,0.985,0.586,1.6,0.867c-0.053-0.356-0.095-0.718-0.124-1.082h5.892c0.043,1.017,0.144,2.005,0.283,2.968 c0.505,0.107,1.018,0.207,1.539,0.297c-0.168-1.051-0.285-2.141-0.335-3.266h2.309l0.089-1.487h-2.427 c0.013-2.498,0.338-4.857,0.896-6.978c2.29,0.701,4.861,1.123,7.587,1.188v5.789h-4.835l1.7,1.487h3.135v2.744l1.487,1.301V22.5 h8.369c-0.09,2.052-0.39,3.998-0.855,5.773c-2.072-0.627-4.386-1.014-6.824-1.127l1.866,1.633 c1.606,0.181,3.141,0.476,4.543,0.892c-1.478,4.476-4.078,7.601-7.099,8.065v-4.344l-1.487,0.832v3.524 c-1.19-0.164-2.317-0.746-3.34-1.658l-0.548,0.308l-0.767,0.428c0.034,0.033,0.067,0.072,0.102,0.105 c-0.059-0.02-0.115-0.045-0.174-0.065l-1.685,0.942c2.166,0.936,4.548,1.463,7.051,1.479c0.021,0,0.042,0.002,0.062,0.002 c0.005,0,0.01,0,0.017,0c0.009,0,0.018,0,0.025,0c5.592,0,10.599-2.545,13.925-6.537c0.306-0.366,0.595-0.747,0.869-1.136 c2.096-2.956,3.331-6.562,3.331-10.451C42.333,17.275,41.098,13.672,39.002,10.717z M13.494,21.015H7.577 c0.032-3.499,1.158-6.736,3.038-9.404c1.127,0.752,2.429,1.411,3.87,1.953C13.862,15.834,13.506,18.354,13.494,21.015z M14.908,12.175c-1.277-0.478-2.428-1.052-3.42-1.702c1.944-2.31,4.502-4.088,7.424-5.073 C17.246,7.007,15.862,9.356,14.908,12.175z M23.465,13.738c-2.586-0.063-5.021-0.453-7.174-1.098 c1.494-4.505,4.125-7.638,7.174-8.057V13.738z M40.841,21.015h-6.002c-0.013-2.648-0.366-5.159-0.982-7.422 c1.472-0.548,2.801-1.216,3.948-1.982C39.685,14.278,40.811,17.516,40.841,21.015z M36.931,10.475 c-1.013,0.663-2.188,1.246-3.497,1.729c-0.963-2.858-2.366-5.235-4.06-6.848C32.353,6.331,34.955,8.129,36.931,10.475z M24.952,4.595c3.021,0.466,5.617,3.593,7.095,8.067c-2.13,0.631-4.536,1.014-7.095,1.076V4.595z M24.952,21.015v-5.789 c2.695-0.064,5.239-0.478,7.508-1.164c0.557,2.114,0.879,4.465,0.893,6.953H24.952z M29.374,36.979 c1.692-1.612,3.1-3.987,4.062-6.847c1.307,0.482,2.481,1.065,3.492,1.728C34.952,34.205,32.353,36.004,29.374,36.979z M37.806,30.727c-1.147-0.768-2.478-1.437-3.949-1.983c0.521-1.925,0.857-4.026,0.953-6.241h5.979 C40.544,25.548,39.474,28.362,37.806,30.727z"></path>
									  <path d="M7.884,28.999c1.895,0.668,3.963,1.189,6.001,1.572c0.003,0,0.007,0,0.01,0.002l0,0c0.416,0.078,0.83,0.15,1.241,0.216 l0,0c0.003,0,0.006,0.001,0.009,0.001c1.266,0.204,2.503,0.354,3.659,0.447l-0.188,3.16l0,0l-0.015,0.256l0.143-0.079l0,0 l4.721-2.64l0,0l1.487-0.83l0,0l1.325-0.742l-2.155-1.885l-1.507-1.319c0,0,0,0-0.001,0l-3.392-2.968l-0.24,4.056 c-0.682-0.056-1.377-0.13-2.076-0.222c-0.379-0.049-0.758-0.104-1.138-0.164l0,0c-0.522-0.082-1.045-0.174-1.564-0.272 c-2.104-0.405-4.149-0.959-5.914-1.628l0,0c-0.308-0.116-0.605-0.236-0.894-0.359c-0.003,0-0.007-0.002-0.01-0.004 c-0.289-0.123-0.568-0.251-0.836-0.382l0,0c-1.204-0.584-2.19-1.229-2.832-1.928c-0.517-0.562-0.75-1.091-0.717-1.591 c0.237-2.792,1.447-2.995,1.701-3.01l0.655-3.015c-0.002,0-0.399,0-0.401,0c-1.542,0-4.557,1.206-4.946,5.798 c-0.092,1.371,0.412,2.666,1.501,3.849c1.398,1.521,3.713,2.742,6.37,3.68l0,0C7.882,28.999,7.883,28.999,7.884,28.999z"></path>
									  <path d="M11.778,32.177c-0.804-0.181-1.604-0.385-2.395-0.61c0.012,0.017,0.021,0.035,0.033,0.051 c0.275,0.39,0.564,0.77,0.869,1.136c1.67,2.002,3.764,3.64,6.14,4.774l0.097-1.625C14.722,34.957,13.118,33.688,11.778,32.177z"></path>
									</g>
								  </g>
								</g>
							  </svg>
							  
							{:else}
							<svg fill="#e7e5e5" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 42.333 42.333" xml:space="preserve" stroke="#333">
								<g id="SVGRepo_bgCarrier" stroke-width="0"></g>
								<g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
								<g id="SVGRepo_iconCarrier">
								  <g>
									<g>
									  <path d="M16.637,33.992l0.057-0.959c-0.204-0.025-0.414-0.056-0.621-0.083C16.252,33.307,16.438,33.658,16.637,33.992z"></path>
									  <path d="M39.002,10.717c-0.274-0.39-0.562-0.77-0.869-1.136C34.807,5.589,29.8,3.043,24.208,3.043c-0.009,0-0.018,0-0.025,0 c-0.007,0-0.012,0-0.017,0c-0.021,0-0.042,0.002-0.062,0.002c-5.548,0.032-10.511,2.571-13.817,6.536 c-0.305,0.366-0.594,0.746-0.869,1.135c-2.095,2.956-3.332,6.56-3.332,10.45c0,0.521,0.026,1.039,0.07,1.55 c0.449,0.296,0.985,0.586,1.6,0.867c-0.053-0.356-0.095-0.718-0.124-1.082h5.892c0.043,1.017,0.144,2.005,0.283,2.968 c0.505,0.107,1.018,0.207,1.539,0.297c-0.168-1.051-0.285-2.141-0.335-3.266h2.309l0.089-1.487h-2.427 c0.013-2.498,0.338-4.857,0.896-6.978c2.29,0.701,4.861,1.123,7.587,1.188v5.789h-4.835l1.7,1.487h3.135v2.744l1.487,1.301V22.5 h8.369c-0.09,2.052-0.39,3.998-0.855,5.773c-2.072-0.627-4.386-1.014-6.824-1.127l1.866,1.633 c1.606,0.181,3.141,0.476,4.543,0.892c-1.478,4.476-4.078,7.601-7.099,8.065v-4.344l-1.487,0.832v3.524 c-1.19-0.164-2.317-0.746-3.34-1.658l-0.548,0.308l-0.767,0.428c0.034,0.033,0.067,0.072,0.102,0.105 c-0.059-0.02-0.115-0.045-0.174-0.065l-1.685,0.942c2.166,0.936,4.548,1.463,7.051,1.479c0.021,0,0.042,0.002,0.062,0.002 c0.005,0,0.01,0,0.017,0c0.009,0,0.018,0,0.025,0c5.592,0,10.599-2.545,13.925-6.537c0.306-0.366,0.595-0.747,0.869-1.136 c2.096-2.956,3.331-6.562,3.331-10.451C42.333,17.275,41.098,13.672,39.002,10.717z M13.494,21.015H7.577 c0.032-3.499,1.158-6.736,3.038-9.404c1.127,0.752,2.429,1.411,3.87,1.953C13.862,15.834,13.506,18.354,13.494,21.015z M14.908,12.175c-1.277-0.478-2.428-1.052-3.42-1.702c1.944-2.31,4.502-4.088,7.424-5.073 C17.246,7.007,15.862,9.356,14.908,12.175z M23.465,13.738c-2.586-0.063-5.021-0.453-7.174-1.098 c1.494-4.505,4.125-7.638,7.174-8.057V13.738z M40.841,21.015h-6.002c-0.013-2.648-0.366-5.159-0.982-7.422 c1.472-0.548,2.801-1.216,3.948-1.982C39.685,14.278,40.811,17.516,40.841,21.015z M36.931,10.475 c-1.013,0.663-2.188,1.246-3.497,1.729c-0.963-2.858-2.366-5.235-4.06-6.848C32.353,6.331,34.955,8.129,36.931,10.475z M24.952,4.595c3.021,0.466,5.617,3.593,7.095,8.067c-2.13,0.631-4.536,1.014-7.095,1.076V4.595z M24.952,21.015v-5.789 c2.695-0.064,5.239-0.478,7.508-1.164c0.557,2.114,0.879,4.465,0.893,6.953H24.952z M29.374,36.979 c1.692-1.612,3.1-3.987,4.062-6.847c1.307,0.482,2.481,1.065,3.492,1.728C34.952,34.205,32.353,36.004,29.374,36.979z M37.806,30.727c-1.147-0.768-2.478-1.437-3.949-1.983c0.521-1.925,0.857-4.026,0.953-6.241h5.979 C40.544,25.548,39.474,28.362,37.806,30.727z"></path>
									  <path d="M7.884,28.999c1.895,0.668,3.963,1.189,6.001,1.572c0.003,0,0.007,0,0.01,0.002l0,0c0.416,0.078,0.83,0.15,1.241,0.216 l0,0c0.003,0,0.006,0.001,0.009,0.001c1.266,0.204,2.503,0.354,3.659,0.447l-0.188,3.16l0,0l-0.015,0.256l0.143-0.079l0,0 l4.721-2.64l0,0l1.487-0.83l0,0l1.325-0.742l-2.155-1.885l-1.507-1.319c0,0,0,0-0.001,0l-3.392-2.968l-0.24,4.056 c-0.682-0.056-1.377-0.13-2.076-0.222c-0.379-0.049-0.758-0.104-1.138-0.164l0,0c-0.522-0.082-1.045-0.174-1.564-0.272 c-2.104-0.405-4.149-0.959-5.914-1.628l0,0c-0.308-0.116-0.605-0.236-0.894-0.359c-0.003,0-0.007-0.002-0.01-0.004 c-0.289-0.123-0.568-0.251-0.836-0.382l0,0c-1.204-0.584-2.19-1.229-2.832-1.928c-0.517-0.562-0.75-1.091-0.717-1.591 c0.237-2.792,1.447-2.995,1.701-3.01l0.655-3.015c-0.002,0-0.399,0-0.401,0c-1.542,0-4.557,1.206-4.946,5.798 c-0.092,1.371,0.412,2.666,1.501,3.849c1.398,1.521,3.713,2.742,6.37,3.68l0,0C7.882,28.999,7.883,28.999,7.884,28.999z"></path>
									  <path d="M11.778,32.177c-0.804-0.181-1.604-0.385-2.395-0.61c0.012,0.017,0.021,0.035,0.033,0.051 c0.275,0.39,0.564,0.77,0.869,1.136c1.67,2.002,3.764,3.64,6.14,4.774l0.097-1.625C14.722,34.957,13.118,33.688,11.778,32.177z"></path>
									</g>
								  </g>
								</g>
							  </svg>
							  
						    {/if}
							
					
						</div>
					</button>
				</Tooltip>
				<Tooltip content="New Chat">
					<button
						id="new-chat-button"
						class=" cursor-pointer p-1.5 flex dark:hover:bg-gray-700 rounded-full transition"
						on:click={() => {
							initNewChat();
						}}
					>
						<div class=" m-auto self-center">
							<svg
								xmlns="http://www.w3.org/2000/svg"
								viewBox="0 0 20 20"
								fill="currentColor"
								class="w-5 h-5"
							>
								<path
									d="M5.433 13.917l1.262-3.155A4 4 0 017.58 9.42l6.92-6.918a2.121 2.121 0 013 3l-6.92 6.918c-.383.383-.84.685-1.343.886l-3.154 1.262a.5.5 0 01-.65-.65z"
								/>
								<path
									d="M3.5 5.75c0-.69.56-1.25 1.25-1.25H10A.75.75 0 0010 3H4.75A2.75 2.75 0 002 5.75v9.5A2.75 2.75 0 004.75 18h9.5A2.75 2.75 0 0017 15.25V10a.75.75 0 00-1.5 0v5.25c0 .69-.56 1.25-1.25 1.25h-9.5c-.69 0-1.25-.56-1.25-1.25v-9.5z"
								/>
							</svg>
						</div>
					</button>
				</Tooltip>
			</div>
		</div>
	</div>
</nav>
